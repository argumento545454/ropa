<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Probador 8.5 franjas reordenar armario</title>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; margin:0; }
  #armarioApp { max-width: 1200px; margin: auto; } /* más espacio */
  .armario-seccion { display: flex; align-items: flex-start; gap: 20px; margin-bottom: 40px; }
  .cuadro { 
    width: 200px; 
    height: 200px; 
    border: 2px solid #333; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    background: #f5f5f5; 
    overflow: hidden; 
    flex-shrink: 0; /* ? evita que se achique */
  }
  .cuadro img { max-width: 100%; max-height: 100%; transition: transform 0.3s; transform-origin: center center; cursor: pointer; }
  .armario-contenedor { display: flex; align-items: flex-start; gap: 10px; flex: 1; }
  .armario { 
    border: 1px solid #ccc; 
    padding: 12px; 
    width: 700px;       
    display: grid; 
    grid-template-columns: repeat(auto-fill, 90px); 
    grid-auto-rows: 90px; 
    gap: 8px; 
    background: #fafafa; 
    max-height: calc(90px * 2 + 8px); /* máximo 2 filas visibles */
    overflow-y: auto; 
    flex: 1; 
  }
  .armario img { width: 90px; height: 90px; object-fit: cover; cursor: grab; border: 2px solid transparent; transition: transform .2s, border .2s; }
  .armario img:hover { transform: scale(1.6); border: 2px solid #333; }
  button { padding: 8px 12px; cursor: pointer; border-radius: 6px; border: 1px solid #333; background: #f0f0f0; transition: background .2s; margin:2px; }
  button:hover { background: #ddd; }
  input[type="file"] { display: none; }
</style>
</head>
<body>

<div id="armarioApp">
  Probador 8.5 franjas reordenar armario

</div>

<script>
(function(){
  const franjas = ["sombrero","logo","blusa","pantalon","zapatos"];
  const app = document.getElementById("armarioApp");
  let estados = {}; // Guarda escala y ángulo por franja

  franjas.forEach(f=>{
    // Sección
    const seccion = document.createElement("div");
    seccion.className="armario-seccion";

    // Cuadro
    const cuadro = document.createElement("div");
    cuadro.className="cuadro";
    cuadro.id="cuadro-"+f;
    if(f==="logo") cuadro.innerHTML="<p>Logo</p>";

    // Botones de selección
    const botones = document.createElement("div");
    const input = document.createElement("input");
    input.type="file"; input.multiple=true; input.id="file-"+f;
    input.addEventListener("change", e=>subirImagenes(f,e.target.files));

    const btnSel = document.createElement("button");
    btnSel.textContent="Select";
    btnSel.onclick=()=>input.click();

    botones.append(input, btnSel);

    // Armario + botón vaciar
    const armarioCont = document.createElement("div");
    armarioCont.className="armario-contenedor";

    const armario = document.createElement("div");
    armario.className="armario"; armario.id="armario-"+f;

    const btnVaciar = document.createElement("button");
    btnVaciar.textContent="Vaciar Armario";
    btnVaciar.onclick=()=>vaciarArmario(f);

    armarioCont.append(armario, btnVaciar);

    seccion.append(cuadro, botones, armarioCont);
    app.appendChild(seccion);

    cargarArmario(f);
  });

  function subirImagenes(franja,files){
    [...files].forEach(file=>{
      const reader = new FileReader();
      reader.onload = e=>{
        guardarImagen(franja,e.target.result);
        agregarAlArmario(franja,e.target.result);
      };
      reader.readAsDataURL(file);
    });
  }

  function guardarImagen(franja,src){
    let data = JSON.parse(localStorage.getItem("armario_"+franja) || "[]");
    data.push(src);
    localStorage.setItem("armario_"+franja,JSON.stringify(data));
  }

  function cargarArmario(franja){
    let data = JSON.parse(localStorage.getItem("armario_"+franja) || "[]");
    data.forEach(src=>agregarAlArmario(franja,src));
  }

  function agregarAlArmario(franja,src){
    const armario = document.getElementById("armario-"+franja);
    const img = document.createElement("img");
    img.src = src;
    img.draggable = true;

    // Drag start ? guardar qué imagen se mueve
    img.addEventListener("dragstart", e=>{
      e.dataTransfer.setData("text/plain", src);
      e.dataTransfer.effectAllowed = "move";
    });

    img.onclick = ()=>mostrarEnCuadro(franja,src);
    img.onmouseover = ()=>mostrarEnCuadro(franja,src);

    armario.appendChild(img);
  }

  // Eventos de drag/drop ? SOLO una vez por armario
  franjas.forEach(f=>{
    const armario = document.getElementById("armario-"+f);

    armario.addEventListener("dragover", e=>e.preventDefault());

    armario.addEventListener("drop", e=>{
      e.preventDefault();
      const srcMovida = e.dataTransfer.getData("text/plain");
      if(!srcMovida) return;

      let data = JSON.parse(localStorage.getItem("armario_"+f) || "[]");
      const fromIndex = data.indexOf(srcMovida);

      // Posición destino
      let children = Array.from(armario.children);
      let targetImg = e.target.closest("img");
      let toIndex = children.indexOf(targetImg);
      if(toIndex === -1) toIndex = data.length-1;

      if(fromIndex > -1){
        data.splice(fromIndex,1); // quitar
        data.splice(toIndex,0,srcMovida); // insertar
        localStorage.setItem("armario_"+f, JSON.stringify(data));

        armario.innerHTML="";
        data.forEach(s=>agregarAlArmario(f,s));
      }
    });
  });

  function mostrarEnCuadro(franja,src){
    const cuadro = document.getElementById("cuadro-"+franja);
    cuadro.innerHTML = '<img src="'+src+'">';
    if(!estados[franja]) estados[franja]={escala:1,angulo:0};

    const img = cuadro.querySelector("img");
    img.onwheel = e=>{
      e.preventDefault();
      e.deltaY<0 ? estados[franja].angulo-=15 : estados[franja].angulo+=15;
      aplicarTransform(franja);
    };
    img.onmouseleave = ()=>{
      img.style.transform = `scale(1) rotate(${estados[franja].angulo}deg)`;
      estados[franja].escala=1;
    };
  }

  function aplicarTransform(franja){
    const img = document.querySelector("#cuadro-"+franja+" img");
    if(img) img.style.transform = `scale(2.2) rotate(${estados[franja].angulo}deg)`;
  }

  function vaciarArmario(franja){
    document.getElementById("armario-"+franja).innerHTML="";
    document.getElementById("cuadro-"+franja).innerHTML=(franja==="logo"?"<p>Logo</p>":"");
    localStorage.removeItem("armario_"+franja);
    estados[franja]={escala:1,angulo:0};
  }

})();
</script>
</body>
</html>