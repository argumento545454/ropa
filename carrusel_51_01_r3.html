<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>carrusel_51_02_r3</title>
<style>
  body {margin:0; padding:0; height:100vh; width:100vw; display:flex; background:#ddd; overflow:hidden; font-family:Arial,sans-serif;}
  
  /* ===== Menï¿½ lateral ===== */
  #menuColDerecha {
    flex:0 0 180px; background:#222; color:#fff; padding:10px; display:flex; flex-direction:column;
  }
  #botonesExtraDerecha { margin-top:auto; display:flex; flex-direction:column; gap:8px; }

  /* ===== Tï¿½tulo categorï¿½a ===== */
#nombreCategoriaMenuDerecha {
  position: absolute;
  top: 25px;                /* mÃ¡s arriba */
  left: 25%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;                /* menos separaciÃ³n entre letras o elementos */
  overflow-x: auto;
  white-space: nowrap;
  padding: 6px 20px;        /* antes 20px â†’ rectÃ¡ngulo mucho mÃ¡s pequeÃ±o */
  width: 20%;               /* menos ancho */
  max-width: 600px;         /* lÃ­mite mÃ¡s compacto */
  background: #ffeb3b;
  border-radius: 6px;       /* bordes mÃ¡s pequeÃ±os */
  justify-content: center;
  align-items: center;
  z-index: 4;
  font-size: 40px;         /* texto proporcionado */
  /*font-size: 1.2em;          texto proporcionado */
  font-weight: bold;
  box-shadow: 1px 1px 4px rgba(0,0,0,0.2); /* sombra suave */
}


  /* ===== Carrusel principal (ovalado) ===== */
  #carruselAutomatico {
    position:absolute; top:400px; left:50%; transform:translateX(-50%);
    width:80%; max-width:1200px; height:320px;
    perspective:1200px; display:flex; justify-content:center; align-items:center; overflow:visible; z-index:5;
  }
  #carruselAutomatico img {
    position:absolute; width:500px; height:500px; object-fit:cover; border-radius:50%;
    transition:transform 0.3s linear, opacity 0.3s linear; will-change: transform, opacity;
  }

  /* ===== Franja de miniaturas ===== */
  #contenedorCarruselDerecha {
    position:absolute; top:1050px; left:30%; transform:translateX(-50%);
    display:flex; gap:20px; overflow-x:auto; white-space:nowrap; padding:20px;
    width:85%; max-width:600px; scrollbar-width:thin; -webkit-overflow-scrolling:touch;
    background:#ccc; border-radius:12px; justify-content:center; align-items:center; z-index:4;
  }
  #contenedorCarruselDerecha::-webkit-scrollbar { height:8px; }
  #contenedorCarruselDerecha::-webkit-scrollbar-thumb { background:rgba(0,0,0,0.3); border-radius:4px; }
  #contenedorCarruselDerecha { -ms-overflow-style:none; scrollbar-width:none; }

  /* ===== Botï¿½n Ropa 1 discreto ===== */
  #btnMostrarRopa1 {
    position:fixed; bottom:10px; right:10px;
    background:#ff9800; color:#fff; border:none; border-radius:10px;
    padding:8px 14px; cursor:pointer; z-index:9999; opacity:0.2;
    transition:opacity 0.3s, transform 0.2s; font-size:16px;
  }
</style>
</head>


<body>

  <!-- Menï¿½ lateral -->
  <div id="menuColDerecha">
    <div id="botonesExtraDerecha"></div>
  </div>

  <!-- Zona principal -->
  <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
    <h2 id="nombreCategoriaMenuDerecha">Tï¿½tulo categorï¿½a</h2>
    <div id="carruselAutomatico"></div>
    <div id="contenedorCarruselDerecha"></div>
  </div>

  <!-- Camara 
  <video id="videoCamara" autoplay style="display:none;"></video>
  <canvas id="canvasCamara" style="display:none;"></canvas>
  <img id="fotoCamara" style="display:none; position:absolute; left:1000px; top:80px; width:200px; height:200px; transition:all 0.5s ease;"/>
-->  

<script>
document.addEventListener("DOMContentLoaded", () => {

  // ====== Variables principales ======
  let categoriasIniciales = JSON.parse(localStorage.getItem('categoriasIniciales') || '[]');
  if (categoriasIniciales.length===0){
    categoriasIniciales = [
      {nombre:"Sombreros", imagenes:[]},
      {nombre:"Blusas", imagenes:[]},
      {nombre:"Pantalones", imagenes:[]},
      {nombre:"Zapatos", imagenes:[]},
      {nombre:"Vestidos", imagenes:[]}
    ];
    localStorage.setItem('categoriasIniciales', JSON.stringify(categoriasIniciales));
  }

  let indiceCategoria=0;
  let tiempoMenu=parseInt(localStorage.getItem('tiempoRotacion'))||3000;
  let velocidadCarrusel=parseFloat(localStorage.getItem('velocidadCarrusel'))||1;
  let intervaloCategorias;

  const menuColDerecha = document.getElementById('menuColDerecha');
  const botonesExtraDerecha = document.getElementById('botonesExtraDerecha');
  const nombreCategoriaElem = document.getElementById('nombreCategoriaMenuDerecha');
  const contenedorCarrusel = document.getElementById('contenedorCarruselDerecha');
  const carruselAutomatico = document.getElementById('carruselAutomatico');

  // ====== Menï¿½ lateral de categorï¿½as ======
  categoriasIniciales.forEach((cat, idx)=>{
    const btn=document.createElement('button');
    btn.textContent=cat.nombre;
    btn.style.cssText="display:block;width:100%;font-size:20px;margin:5px 0;padding:10px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;";
    btn.addEventListener('click',()=>{ indiceCategoria=idx; mostrarCategoria(); });
    menuColDerecha.insertBefore(btn, botonesExtraDerecha);
  });

  // ====== Botones extra ======
  const btnSubirImg=document.createElement("button");
  btnSubirImg.textContent="Subir img";
  btnSubirImg.style.cssText="padding:6px;background:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:20px;";

  const contTiempo=document.createElement("div");
  contTiempo.style.cssText="display:flex;flex-direction:column;align-items:center;gap:4px;background:#ff9800;border-radius:6px;padding:6px;font-size:18px;";
  const textoTiempo=document.createElement("div");
  textoTiempo.style.cssText="color:#fff;font-weight:bold;";
  const flechaArriba=document.createElement("button");
  const flechaAbajo=document.createElement("button");
  [flechaArriba,flechaAbajo].forEach(b=>{ b.style.cssText="width:100%;border:none;background:#fff;color:#ff9800;font-size:16px;border-radius:4px;cursor:pointer;"; });
  flechaArriba.textContent="?"; flechaAbajo.textContent="?";
  contTiempo.append(flechaArriba,textoTiempo,flechaAbajo);

  const btnVelocidad=document.createElement("button");
  btnVelocidad.textContent="Velocidad";
  btnVelocidad.style.cssText="padding:6px;background:#673ab7;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:20px;";

  botonesExtraDerecha.append(btnSubirImg,contTiempo,btnVelocidad);

  // ====== Subir imagen ======
  btnSubirImg.addEventListener("click",()=>{
    const input=document.createElement("input");
    input.type="file"; input.accept="image/*"; input.multiple=true;
    input.onchange=e=>{
      Array.from(e.target.files).forEach(f=>{
        const fr=new FileReader();
        fr.onload=ev=>{
          categoriasIniciales[indiceCategoria].imagenes.push(ev.target.result);
          localStorage.setItem('categoriasIniciales',JSON.stringify(categoriasIniciales));
          mostrarCategoria();
        };
        fr.readAsDataURL(f);
      });
    };
    input.click();
  });

  // ====== Control tiempo ======
  function reiniciarIntervaloMenu(){
    clearInterval(intervaloCategorias);
    intervaloCategorias=setInterval(()=>{
      indiceCategoria=(indiceCategoria+1)%categoriasIniciales.length;
      mostrarCategoria();
    }, tiempoMenu);
    localStorage.setItem('tiempoRotacion',tiempoMenu);
  }
  flechaArriba.addEventListener("click",()=>{ tiempoMenu=Math.min(tiempoMenu+5000,90000); textoTiempo.textContent=`Tiempo: ${(tiempoMenu/1000).toFixed(1)}s`; reiniciarIntervaloMenu(); });
  flechaAbajo.addEventListener("click",()=>{ tiempoMenu=Math.max(tiempoMenu-5000,5000); textoTiempo.textContent=`Tiempo: ${(tiempoMenu/1000).toFixed(1)}s`; reiniciarIntervaloMenu(); });

  // ====== Control velocidad ======
  btnVelocidad.addEventListener("click",()=>{
    velocidadCarrusel+=0.2; if(velocidadCarrusel>3) velocidadCarrusel=0.4;
    localStorage.setItem('velocidadCarrusel',velocidadCarrusel);
    btnVelocidad.textContent=`Velocidad ï¿½${velocidadCarrusel.toFixed(1)}`;
  });

  // ====== Carrusel ovalado ======
  function iniciarCarrusel(){
    carruselAutomatico.innerHTML="";
    const categoria=categoriasIniciales[indiceCategoria];
    if(!categoria || !categoria.imagenes || categoria.imagenes.length===0) return;

    const radioX=Math.max(200,(carruselAutomatico.clientWidth/2)-120);

    const radioY=Math.max(120,(carruselAutomatico.clientHeight/2)-40);

    const imgs=[];
    categoria.imagenes.forEach((url,idx)=>{
      const img=document.createElement("img");
      img.src=url; img.className="imgCarrusel"; img.dataset.index=idx; img._hover=false;
      carruselAutomatico.appendChild(img); imgs.push(img);

      img.addEventListener("mouseenter",()=>{ img._hover=true; window.__ropa3_paused=true; });
      img.addEventListener("mouseleave",()=>{ img._hover=false; window.__ropa3_paused=false; });

      img.addEventListener("click",()=>{
        const arr=categoria.imagenes; const i=parseInt(img.dataset.index,10);
        if(!isNaN(i) && arr[i]){
          const item=arr.splice(i,1)[0]; arr.unshift(item);
          localStorage.setItem('categoriasIniciales',JSON.stringify(categoriasIniciales));
          mostrarCategoria();
        }
      });
    });

    let angulo=0; let ultimo=performance.now(); window.__ropa3_paused=false;
    function animarOval(now){
      const delta=(now-ultimo)/1000; ultimo=now;
      if(!window.__ropa3_paused) angulo+=velocidadCarrusel*60*delta;
      imgs.forEach((el,i)=>{
        const fase=(i*360/imgs.length+angulo)*Math.PI/180;
        const x=Math.cos(fase)*radioX;
        const y=Math.sin(fase)*radioY*0.7;
        const z=Math.sin(fase)*80;
        const baseScale=1+z/400;
        const hoverExtra=el._hover?1.35:1;
        const escalaFinal=baseScale*hoverExtra;
        const op=Math.min(1,Math.max(0.2,0.55+z/200));
        el.style.transform=`translate3d(${x}px,${y}px,${z}px) scale(${escalaFinal})`;
        el.style.opacity=op;
        el.style.zIndex=Math.round(300+z);
        el.dataset.index=i;
      });
      requestAnimationFrame(animarOval);
    }
    ultimo=performance.now(); requestAnimationFrame(animarOval);
  }

  // ====== Mostrar categorï¿½a ======
  function mostrarCategoria(){
    const categoria=categoriasIniciales[indiceCategoria];
    nombreCategoriaElem.textContent=categoria.nombre;

    // Franja miniaturas
    contenedorCarrusel.innerHTML="";
    categoria.imagenes.forEach((imgSrc,idx)=>{
      const wrapper=document.createElement("div"); wrapper.style.cssText="position:relative;width:60px;height:60px;";
      const miniatura=document.createElement("img"); miniatura.src=imgSrc; miniatura.style.cssText="width:100%;height:100%;object-fit:cover;border-radius:8px;cursor:pointer;";
      miniatura.addEventListener("click",()=>{ mostrarCategoria(); });
      const btnEliminar=document.createElement("button"); btnEliminar.textContent="ï¿½";
      btnEliminar.style.cssText="position:absolute;top:-6px;right:-6px;width:18px;height:18px;font-size:14px;color:#fff;background:#f44336;border:none;border-radius:50%;cursor:pointer;";
      btnEliminar.addEventListener("click",()=>{ categoria.imagenes.splice(idx,1); localStorage.setItem('categoriasIniciales',JSON.stringify(categoriasIniciales)); mostrarCategoria(); });
      wrapper.append(miniatura,btnEliminar); contenedorCarrusel.appendChild(wrapper);
    });

    iniciarCarrusel();
    textoTiempo.textContent=`Tiempo: ${(tiempoMenu/1000).toFixed(1)}s`;
    btnVelocidad.textContent=`Velocidad Images ï¿½${velocidadCarrusel.toFixed(1)}`;
  }

  mostrarCategoria();
  reiniciarIntervaloMenu();

  // ====== Camara foto ======
/*
  const videoCamara=document.getElementById('videoCamara');
  const canvasCamara=document.getElementById('canvasCamara');
  const fotoCamara=document.getElementById('fotoCamara');
  navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{ videoCamara.srcObject=stream; });

  videoCamara.style.display='block';
  const btnTomarFoto=document.createElement("button");
  btnTomarFoto.textContent="Tomar foto";
  btnTomarFoto.style.cssText="position:fixed; bottom:10px; left:10px; padding:8px;background:#2196f3;color:#fff;border:none;border-radius:6px; cursor:pointer; z-index:9999;";
  document.body.appendChild(btnTomarFoto);
  btnTomarFoto.addEventListener("click",()=>{
    canvasCamara.width=videoCamara.videoWidth;
    canvasCamara.height=videoCamara.videoHeight;
    const ctx=canvasCamara.getContext('2d');
    ctx.drawImage(videoCamara,0,0,canvasCamara.width,canvasCamara.height);
    fotoCamara.src=canvasCamara.toDataURL(); fotoCamara.style.display='block';
  });
*/


  // ====== Botï¿½n discreto Ropa1 ======
  const ropa1=document.getElementById("ropa1")||document.querySelector(".ropa1");
  if(ropa1){ ropa1.style.display="none"; ropa1.style.opacity="0"; }
  const btnMostrarRopa1=document.createElement("button"); btnMostrarRopa1.id="btnMostrarRopa1"; btnMostrarRopa1.textContent="?? Ropa 1";
  btnMostrarRopa1.title="Click o Ctrl+Alt+R para mostrar/ocultar Ropa 1";
  btnMostrarRopa1.addEventListener("click",()=>{ 
    if(!ropa1) return;
    const visible=ropa1.style.display!=="none";
    ropa1.style.display=visible?"none":"block";
    ropa1.style.opacity=visible?"0":"1";
  });
  btnMostrarRopa1.addEventListener("mouseenter",()=>{ btnMostrarRopa1.style.opacity="1"; btnMostrarRopa1.style.transform="scale(1.05)"; });
  btnMostrarRopa1.addEventListener("mouseleave",()=>{ btnMostrarRopa1.style.opacity="0.2"; btnMostrarRopa1.style.transform="scale(1)"; });
  document.body.appendChild(btnMostrarRopa1);

  document.addEventListener("keydown",(e)=>{ if(e.ctrlKey && e.altKey && e.key.toLowerCase()==="r"){ btnMostrarRopa1.click(); } });
});
</script>





<!-- ================= CÃ¡mara independiente ================= -->
<div id="camaraWidget">
  <video id="videoCamara" autoplay></video>
  <canvas id="canvasCamara" style="display:none;"></canvas>
  <div id="camaraControles">
    <button id="btnCapturar">ðŸ“¸ Capturar</button>
    <button id="btnCerrarCamara">âœ– Cerrar</button>
  </div>
</div>

<style>
  /* Contenedor general */
  #camaraWidget {
    display: none; /* se activa con JS */
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 320px;
    height: 240px;
    background: #000;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    overflow: hidden;
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
  }
  #camaraWidget video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
  }
  #camaraControles {
    position: absolute;
    bottom: 8px; left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
  }
  #camaraControles button {
    padding: 6px 12px;
    background: #ff9800;
    border: none;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const camaraWidget = document.getElementById('camaraWidget');
  const videoCamara = document.getElementById('videoCamara');
  const canvasCamara = document.getElementById('canvasCamara');
  const btnCapturar = document.getElementById('btnCapturar');
  const btnCerrarCamara = document.getElementById('btnCerrarCamara');

  let streamCamara = null;
  let modoPantallaCompleta = false;

  // FunciÃ³n abrir cÃ¡mara
  function abrirCamara() {
    camaraWidget.style.display = 'flex';
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        streamCamara = stream;
        videoCamara.srcObject = stream;
      })
      .catch(err => alert('No se pudo acceder a la cÃ¡mara: ' + err));
  }

  // Cerrar cÃ¡mara
  btnCerrarCamara.addEventListener('click', () => {
    if(streamCamara){
      streamCamara.getTracks().forEach(track=>track.stop());
      streamCamara=null;
    }
    camaraWidget.style.display='none';
    modoPantallaCompleta=false;
    btnCapturar.textContent='ðŸ“¸ Capturar';
    videoCamara.style.width='100%';
    videoCamara.style.height='100%';
  });

  // Capturar foto
  btnCapturar.addEventListener('click', () => {
    if(!modoPantallaCompleta){
      // expandir a pantalla completa
      camaraWidget.style.position='fixed';
      camaraWidget.style.top='0';
      camaraWidget.style.left='0';
      camaraWidget.style.width='100vw';
      camaraWidget.style.height='100vh';
      camaraWidget.style.transform='none';
      videoCamara.style.width='100%';
      videoCamara.style.height='100%';
      btnCapturar.textContent='ðŸ“¸ Tomar foto ahora';
      modoPantallaCompleta=true;
      return;
    }
    // tomar foto
    canvasCamara.width = videoCamara.videoWidth;
    canvasCamara.height = videoCamara.videoHeight;
    const ctx = canvasCamara.getContext('2d');
    ctx.drawImage(videoCamara,0,0,canvasCamara.width,canvasCamara.height);
    const foto = canvasCamara.toDataURL('image/png');
    console.log('Foto capturada:', foto);

    // volver a tamaÃ±o pequeÃ±o
    camaraWidget.style.position='absolute';
    camaraWidget.style.top='50%';
    camaraWidget.style.left='50%';
    camaraWidget.style.transform='translate(-50%, -50%)';
    camaraWidget.style.width='320px';
    camaraWidget.style.height='240px';
    modoPantallaCompleta=false;
    btnCapturar.textContent='ðŸ“¸ Capturar';
  });

  // Abrir cÃ¡mara automÃ¡ticamente o desde botÃ³n externo
  abrirCamara();
});
</script>
  

</body>
</html>





